import model.convert as convert
import numpy as np

Elements = {
    1: 'C', 2: 'C', 3: 'C', 4: 'C', 5: 'C',
    6: 'C', 7: 'C', 8: 'C', 9: 'C', 10: 'O',
    11: 'O', 12: 'N', 13: 'C', 14: 'O', 15: 'C',
    16: 'N', 17: 'C', 18: 'O', 19: 'C', 20: 'N',
    21: 'H', 22: 'H', 23: 'H', 24: 'H', 25: 'H',
    26: 'H', 27: 'H', 28: 'H', 29: 'H', 30: 'H',
    31: 'H', 32: 'H', 33: 'H', 34: 'H', 35: 'H',
    36: 'H', 37: 'H'
}

Structure = {
    1: [1], 2: [2, 1], 3: [3, 2, 1], 4: [4, 3, 2, 1], 5: [5, 4, 3, 2],
    6: [6, 1, 2, 3], 7: [7, 6, 1, 2], 8: [8, 7, 6, 1], 9: [9, 8, 7, 6],
    10: [10, 9, 8, 7], 11: [11, 9, 8, 7], 12: [12, 8, 7, 6], 13: [13, 12, 8, 7],
    14: [14, 13, 12, 8], 15: [15, 13, 12, 8], 16: [16, 15, 13, 12], 17: [17, 16, 15, 13],
    18: [18, 17, 16, 15], 19: [19, 17, 16, 15], 20: [20, 19, 17, 16], 21: [21, 11, 9, 8],
    22: [22, 8, 7, 6], 23: [23, 12, 8, 7], 24: [24, 15, 13, 12], 25: [25, 15, 13, 12],
    26: [26, 16, 15, 13], 27: [27, 19, 17, 16], 28: [28, 19, 17, 16], 29: [29, 20, 19, 17],
    30: [30, 20, 19, 17], 31: [31, 7, 6, 1], 32: [32, 7, 6, 1], 33: [33, 5, 4, 3],
    34: [34, 4, 3, 2], 35: [35, 3, 2, 1], 36: [36, 2, 1, 3], 37: [37, 1, 2, 3]
}

Data = {
    'r2': 1.398,
    'r3': 1.3962, 'a3': 120.0,
    'r4': 1.3979, 'a4': 119.51, 'd4': 0.69,
    'r5': 1.3944, 'a5': 120.36, 'd5': 359.99,
    'r6': 1.4027, 'a6': 121.02, 'd6': 359.23,
    'r7': 1.5107, 'a7': 120.54, 'd7': 177.51,
    'r8': 1.5476, 'a8': 112.22, 'd8': '{D1}',
    'r9': 1.5527, 'a9': 109.68, 'd9': '{D2}',
    'r10': 1.2137, 'a10': 119.32, 'd10': '{D8}',
    'r11': 1.3371, 'a11': 119.29, 'd11': '{d10} - 180.41',
    'r12': 1.4431, 'a12': 109.91, 'd12': '{d9} - 233.04',
    'r13': 1.3616, 'a13': 124.07, 'd13': '{D3}',
    'r14': 1.2242, 'a14': 124.63, 'd14': 348.37,
    'r15': 1.5393, 'a15': 114.7, 'd15': 167.25,
    'r16': 1.4502, 'a16': 115.51, 'd16': '{D4}',
    'r17': 1.3538, 'a17': 122.46, 'd17': '{D5}',
    'r18': 1.2373, 'a18': 123.76, 'd18': 3.85,
    'r19': 1.5279, 'a19': 114.77, 'd19': 182.7,
    'r20': 1.4655, 'a20': 112.81, 'd20': '{D6}',
    'r21': 0.9921, 'a21': 115.21, 'd21': '{D9}',
    'r22': 1.099, 'a22': 109.48, 'd22': '{d9} - 114.42',
    'r23': 1.0158, 'a23': 117.21, 'd23': '{d13} + 168.93',
    'r24': 1.0992, 'a24': 105.24, 'd24': '{d16} - 122.09',
    'r25': 1.0967, 'a25': 108.54, 'd25': '{d16} - 237.24',
    'r26': 1.0215, 'a26': 122.81, 'd26': '{d17} - 175.98',
    'r27': 1.1022, 'a27': 106.36, 'd27': '{d20} - 125.96',
    'r28': 1.0995, 'a28': 106.37, 'd28': '{d20} - 239.29',
    'r29': 1.0205, 'a29': 110.22, 'd29': '{D7}',
    'r30': 1.0172, 'a30': 111.47, 'd30': '{d29} - 119.35',
    'r31': 1.0975, 'a31': 111.11, 'd31': '{d8} - 119.85',
    'r32': 1.0984, 'a32': 109.72, 'd32': '{d8} - 239.48',
    'r33': 1.0907, 'a33': 119.79, 'd33': 179.38,
    'r34': 1.09, 'a34': 120.0, 'd34': 179.3,
    'r35': 1.0903, 'a35': 120.35, 'd35': 179.57,
    'r36': 1.0914, 'a36': 119.74, 'd36': 178.66,
    'r37': 1.0918, 'a37': 119.79, 'd37': 180.31}

Dimension = 9
Zero_Energy = -26399


def feature2atoms(f):
    dihe_angles = {
        "D1": f[0] / 2, "D2": f[1], "D3": f[2], "D4": f[3], "D5": f[4],
        "D6": f[5], "D7": f[6], "D8": f[7], "D9": f[8]
    }

    data = convert.generate_data(Data, **dihe_angles)
    pos = convert.generate_position(Structure, data)
    return Elements, pos


def atoms2feature(e, pos):
    template = {"elements": Elements, "structure": Structure, "data": Data}
    e, pos = convert.auto_refine(
        e, pos, template, radius_error=0.15, angle_error=20)
    data = convert.generate_variable(Structure, pos)
    args = (8, 9, 13, 16, 17, 20, 29, 10, 21)
    feature = [data["d%d" % i] for i in args]
    feature[0] = (feature[0] * 2) % 360

    return feature
