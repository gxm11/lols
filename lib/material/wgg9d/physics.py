import model.convert as convert
import numpy as np

Elements = {
    1: 'C', 2: 'C', 3: 'C', 4: 'C', 5: 'C',
    6: 'C', 7: 'N', 8: 'C', 9: 'C', 10: 'C',
    11: 'C', 12: 'N', 13: 'C', 14: 'O', 15: 'N',
    16: 'C', 17: 'C', 18: 'O', 19: 'N', 20: 'C',
    21: 'C', 22: 'O', 23: 'O', 24: 'H', 25: 'H',
    26: 'H', 27: 'H', 28: 'H', 29: 'H', 30: 'H',
    31: 'H', 32: 'H', 33: 'H', 34: 'H', 35: 'H',
    36: 'H', 37: 'H', 38: 'H', 39: 'H', 40: 'H',
    41: 'H'}

Structure = {
    1: [1], 2: [2, 1], 3: [3, 2, 1], 4: [4, 3, 2, 1], 5: [5, 4, 3, 2],
    6: [6, 5, 4, 3], 7: [7, 1, 2, 3], 8: [8, 7, 1, 2], 9: [9, 8, 7, 1],
    10: [10, 9, 8, 7], 11: [11, 10, 9, 8], 12: [12, 11, 10, 9], 13: [13, 11, 10, 9],
    14: [14, 13, 11, 10], 15: [15, 13, 11, 10], 16: [16, 15, 13, 11], 17: [17, 16, 15, 13],
    18: [18, 17, 16, 15], 19: [19, 17, 16, 15], 20: [20, 19, 17, 16], 21: [21, 20, 19, 17],
    22: [22, 21, 20, 19], 23: [23, 21, 20, 19], 24: [24, 23, 21, 20], 25: [25, 20, 19, 17],
    26: [26, 20, 19, 17], 27: [27, 19, 17, 16], 28: [28, 16, 15, 13], 29: [29, 16, 15, 13],
    30: [30, 15, 13, 11], 31: [31, 11, 10, 9], 32: [32, 12, 11, 10], 33: [33, 12, 11, 10],
    34: [34, 10, 9, 8], 35: [35, 10, 9, 8], 36: [36, 8, 7, 1], 37: [37, 7, 1, 2],
    38: [38, 2, 1, 3], 39: [39, 3, 2, 1], 40: [40, 4, 3, 2], 41: [41, 5, 4, 3]
}


Data = {
    'r2': 1.3975,
    'r3': 1.3909, 'a3': 117.61,
    'r4': 1.4101, 'a4': 121.25, 'd4': 359.64,
    'r5': 1.3901, 'a5': 121.13, 'd5': 0.57,
    'r6': 1.4076, 'a6': 119.12, 'd6': 0.17,
    'r7': 1.3743, 'a7': 130.5, 'd7': 179.23,
    'r8': 1.3749, 'a8': 109.22, 'd8': 179.2,
    'r9': 1.3806, 'a9': 110.36, 'd9': 0.67,
    'r10': 1.4966, 'a10': 126.29, 'd10': 183.23,
    'r11': 1.55, 'a11': 112.49, 'd11': '{D1}',
    'r12': 1.4686, 'a12': 114.94, 'd12': '{D2}',
    'r13': 1.5396, 'a13': 109.83, 'd13': '{d12} + 234.82',
    'r14': 1.2427, 'a14': 122.19, 'd14': '{D3}',
    'r15': 1.3488, 'a15': 114.25, 'd15': '{d14} - 179.37',
    'r16': 1.4513, 'a16': 123.34, 'd16': 175.86,
    'r17': 1.5333, 'a17': 112.38, 'd17': '{D4}',
    'r18': 1.2459, 'a18': 121.94, 'd18': '{D5}',
    'r19': 1.3463, 'a19': 114.58, 'd19': '{d18} + 180.83',
    'r20': 1.4569, 'a20': 122.5, 'd20': 180.52,
    'r21': 1.5391, 'a21': 113.69, 'd21': '{D6}',
    'r22': 1.2185, 'a22': 122.46, 'd22': '{D7}',
    'r23': 1.3337, 'a23': 115.4, 'd23': '{d22} + 180.12',
    'r24': 1.0114, 'a24': 109.4, 'd24': '{D8}',
    'r25': 1.1016, 'a25': 109.04, 'd25': '{d21} - 239.05',
    'r26': 1.0933, 'a26': 108.64, 'd26': '{d21} - 120.50',
    'r27': 1.0334, 'a27': 116.15, 'd27': 8.76,
    'r28': 1.0938, 'a28': 109.11, 'd28': '{d17} + 119.23',
    'r29': 1.1008, 'a29': 109.07, 'd29': '{d17} + 238.62',
    'r30': 1.0235, 'a30': 114.09, 'd30': 358.71,
    'r31': 1.1026, 'a31': 108.22, 'd31': '{d12} + 120.93',
    'r32': 1.0177, 'a32': 110.97, 'd32': '{D9}',
    'r33': 1.0232, 'a33': 109.87, 'd33': '{d32} + 241.64',
    'r34': 1.1007, 'a34': 110.6, 'd34': '{d11} + 120.66',
    'r35': 1.098, 'a35': 110.47, 'd35': '{d11} + 239.32',
    'r36': 1.0845, 'a36': 120.39, 'd36': 179.63,
    'r37': 1.0183, 'a37': 127.17, 'd37': 6.5,
    'r38': 1.0899, 'a38': 121.18, 'd38': 180.0,
    'r39': 1.0896, 'a39': 119.4, 'd39': 179.99,
    'r40': 1.0898, 'a40': 119.2, 'd40': 180.78,
    'r41': 1.0915, 'a41': 120.26, 'd41': 180.79}

Dimension = 9
Zero_Energy = -29977


def feature2atoms(f):
    dihe_angles = {
        "D1": f[0], "D2": f[1], "D3": f[2], "D4": f[3], "D5": f[4],
        "D6": f[5], "D7": f[6], "D8": f[7], "D9": f[8]
    }

    data = convert.generate_data(Data, **dihe_angles)
    pos = convert.generate_position(Structure, data)
    return Elements, pos


def atoms2feature(e, pos):
    template = {"elements": Elements, "structure": Structure, "data": Data}
    e, pos = convert.auto_refine(
        e, pos, template, radius_error=0.15, angle_error=20)
    data = convert.generate_variable(Structure, pos)
    args = (11, 12, 14, 17, 18, 21, 22, 24, 32)
    feature = [data["d%d" % i] for i in args]

    return feature
