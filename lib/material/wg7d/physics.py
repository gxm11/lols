import model.convert as convert
import numpy as np

Elements = {
    1: 'C', 2: 'C', 3: 'C', 4: 'C', 5: 'C',
    6: 'C', 7: 'N', 8: 'C', 9: 'C', 10: 'C',
    11: 'C', 12: 'N', 13: 'C', 14: 'O', 15: 'N',
    16: 'C', 17: 'C', 18: 'O', 19: 'O', 20: 'H',
    21: 'H', 22: 'H', 23: 'H', 24: 'H', 25: 'H',
    26: 'H', 27: 'H', 28: 'H', 29: 'H', 30: 'H',
    31: 'H', 32: 'H', 33: 'H', 34: 'H'
}

Structure = {
    1: [1], 2: [2, 1], 3: [3, 2, 1], 4: [4, 3, 2, 1], 5: [5, 4, 3, 2],
    6: [6, 5, 4, 3], 7: [7, 1, 2, 3], 8: [8, 7, 1, 2], 9: [9, 8, 7, 1],
    10: [10, 9, 8, 7], 11: [11, 10, 9, 8], 12: [12, 11, 10, 9], 13: [13, 11, 10, 9],
    14: [14, 13, 11, 10], 15: [15, 13, 11, 10], 16: [16, 15, 13, 11], 17: [17, 16, 15, 13],
    18: [18, 17, 16, 15], 19: [19, 17, 16, 15], 20: [20, 19, 17, 16], 21: [21, 16, 15, 13],
    22: [22, 16, 15, 13], 23: [23, 15, 13, 11], 24: [24, 11, 10, 9], 25: [25, 12, 11, 10],
    26: [26, 12, 11, 10], 27: [27, 10, 9, 8], 28: [28, 10, 9, 8], 29: [29, 8, 7, 1],
    30: [30, 7, 1, 2], 31: [31, 2, 1, 3], 32: [32, 3, 2, 1], 33: [33, 4, 3, 2],
    34: [34, 5, 4, 3]
}

Data = {
    'r2': 1.397,
    'r3': 1.3912, 'a3': 117.51,
    'r4': 1.4098, 'a4': 121.24, 'd4': 359.76,
    'r5': 1.3899, 'a5': 121.16, 'd5': 0.24,
    'r6': 1.4071, 'a6': 119.07, 'd6': 0.12,
    'r7': 1.3769, 'a7': 130.73, 'd7': 179.77,
    'r8': 1.3785, 'a8': 109.63, 'd8': 179.89,
    'r9': 1.3801, 'a9': 109.83, 'd9': 0.21,
    'r10': 1.4976, 'a10': 126.86, 'd10': 184.03,
    'r11': 1.5521, 'a11': 111.96, 'd11': '{D1}',
    'r12': 1.4679, 'a12': 114.5, 'd12': '{D2}',
    'r13': 1.5355, 'a13': 108.55, 'd13': '{d12} + 235.66',
    'r14': 1.2489, 'a14': 121.35, 'd14': '{D3}',
    'r15': 1.3408, 'a15': 115.25, 'd15': '{d14} - 181.35',
    'r16': 1.4546, 'a16': 123.9, 'd16': 177.93,
    'r17': 1.5437, 'a17': 114.12, 'd17': '{D4}',
    'r18': 1.2112, 'a18': 122.43, 'd18': '{D5}',
    'r19': 1.3424, 'a19': 114.84, 'd19': '{d18} + 178.55',
    'r20': 1.012, 'a20': 109.22, 'd20': '{D6}',
    'r21': 1.0931, 'a21': 108.74, 'd21': '{d17} + 120.33',
    'r22': 1.1026, 'a22': 109.33, 'd22': '{d17} + 239.05',
    'r23': 1.0229, 'a23': 114.06, 'd23': 1.45,
    'r24': 1.1015, 'a24': 108.42, 'd24': '{d12} + 121.68',
    'r25': 1.0173, 'a25': 111.26, 'd25': '{D7}',
    'r26': 1.0229, 'a26': 110.08, 'd26': '{d25} + 240.99',
    'r27': 1.0999, 'a27': 110.21, 'd27': '{d11} + 120.43',
    'r28': 1.0977, 'a28': 110.95, 'd28': '{d11} + 239.35',
    'r29': 1.0847, 'a29': 120.34, 'd29': 180.9,
    'r30': 1.0111, 'a30': 125.6, 'd30': 1.6,
    'r31': 1.0903, 'a31': 121.37, 'd31': 180.02,
    'r32': 1.0895, 'a32': 119.38, 'd32': 179.93,
    'r33': 1.0898, 'a33': 119.18, 'd33': 180.49,
    'r34': 1.0912, 'a34': 120.37, 'd34': 180.6}

Dimension = 7
Zero_Energy = -24320


def feature2atoms(f):
    dihe_angles = {
        "D1": f[0], "D2": f[1], "D3": f[2], "D4": f[3], "D5": f[4],
        "D6": f[5], "D7": f[6]
    }

    data = convert.generate_data(Data, **dihe_angles)
    pos = convert.generate_position(Structure, data)
    return Elements, pos


def atoms2feature(e, pos):
    template = {"elements": Elements, "structure": Structure, "data": Data}
    e, pos = convert.auto_refine(
        e, pos, template, radius_error=0.15, angle_error=20)
    data = convert.generate_variable(Structure, pos)
    args = (11, 12, 14, 17, 18, 20, 25)
    feature = [data["d%d" % i] for i in args]

    return feature
