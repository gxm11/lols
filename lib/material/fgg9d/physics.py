import model.convert as convert
import numpy as np

Elements = {
    1: 'C', 2: 'C', 3: 'C', 4: 'C', 5: 'C',
    6: 'C', 7: 'C', 8: 'C', 9: 'C', 10: 'N',
    11: 'O', 12: 'C', 13: 'C', 14: 'N', 15: 'O',
    16: 'C', 17: 'C', 18: 'O', 19: 'O', 20: 'N',
    21: 'H', 22: 'H', 23: 'H', 24: 'H', 25: 'H',
    26: 'H', 27: 'H', 28: 'H', 29: 'H', 30: 'H',
    31: 'H', 32: 'H', 33: 'H', 34: 'H', 35: 'H',
    36: 'H', 37: 'H'
}

Structure = {
    1: [1], 2: [2, 1], 3: [3, 2, 1], 4: [4, 3, 2, 1], 5: [5, 4, 3, 2],
    6: [6, 1, 2, 3], 7: [7, 6, 1, 2], 8: [8, 7, 6, 1], 9: [9, 8, 7, 6],
    10: [10, 9, 8, 7], 11: [11, 9, 8, 7], 12: [12, 10, 9, 8], 13: [13, 12, 10, 9],
    14: [14, 13, 12, 10], 15: [15, 13, 12, 10], 16: [16, 14, 13, 12], 17: [17, 16, 14, 13],
    18: [18, 17, 16, 14], 19: [19, 17, 16, 14], 20: [20, 8, 7, 6], 21: [21, 18, 17, 16],
    22: [22, 16, 14, 13], 23: [23, 16, 14, 13], 24: [24, 14, 13, 12], 25: [25, 12, 10, 9],
    26: [26, 12, 10, 9], 27: [27, 10, 9, 8], 28: [28, 20, 8, 7], 29: [29, 20, 8, 7],
    30: [30, 8, 7, 6], 31: [31, 7, 6, 1], 32: [32, 7, 6, 1], 33: [33, 5, 4, 3],
    34: [34, 4, 3, 2], 35: [35, 3, 2, 1], 36: [36, 2, 1, 3], 37: [37, 1, 2, 3]
}

Data = {
    'r2': 1.3965,
    'r3': 1.3954, 'a3': 120.04,
    'r4': 1.3973, 'a4': 119.69, 'd4': 0.67,
    'r5': 1.3959, 'a5': 120.05, 'd5': 359.52,
    'r6': 1.4, 'a6': 120.95, 'd6': 359.86,
    'r7': 1.5071, 'a7': 121.3, 'd7': 176.75,
    'r8': 1.5506, 'a8': 113.59, 'd8': '{D1}',
    'r9': 1.5406, 'a9': 109.65, 'd9': '{D2}',
    'r10': 1.3577, 'a10': 116.34, 'd10': '{d11} + 180.63',
    'r11': 1.2408, 'a11': 121.39, 'd11': '{D3}',
    'r12': 1.457, 'a12': 122.7, 'd12': 178.82,
    'r13': 1.5341, 'a13': 114.38, 'd13': '{D4}',
    'r14': 1.346, 'a14': 115.02, 'd14': '{d15} - 179.62',
    'r15': 1.2449, 'a15': 121.43, 'd15': '{D5}',
    'r16': 1.4572, 'a16': 123.05, 'd16': 176.4,
    'r17': 1.542, 'a17': 114.38, 'd17': '{D6}',
    'r18': 1.3425, 'a18': 114.92, 'd18': '{D7}',
    'r19': 1.2116, 'a19': 122.55, 'd19': '{d18} - 178.82',
    'r20': 1.4554, 'a20': 109.49, 'd20': '{d9} + 124.43',
    'r21': 1.0071, 'a21': 109.28, 'd21': '{D8}',
    'r22': 1.0931, 'a22': 108.33, 'd22': '{d17} + 120.16',
    'r23': 1.1022, 'a23': 109.18, 'd23': '{d17} + 239.66',
    'r24': 1.0287, 'a24': 116.64, 'd24': 356.57,
    'r25': 1.0997, 'a25': 108.12, 'd25': '{d13} - 238.32',
    'r26': 1.0941, 'a26': 108.85, 'd26': '{d13} - 119.92',
    'r27': 1.0171, 'a27': 117.89, 'd27': 12.37,
    'r28': 1.0233, 'a28': 108.64, 'd28': '{D9}',
    'r29': 1.0209, 'a29': 110.0, 'd29': '{d28} - 115.00',
    'r30': 1.1012, 'a30': 107.9, 'd30': '{d9} + 241.89',
    'r31': 1.0995, 'a31': 111.09, 'd31': '{d8} - 119.30',
    'r32': 1.1005, 'a32': 110.2, 'd32': '{d8} - 237.94',
    'r33': 1.0925, 'a33': 119.63, 'd33': 179.13,
    'r34': 1.0904, 'a34': 120.13, 'd34': 179.01,
    'r35': 1.0898, 'a35': 120.18, 'd35': 180.38,
    'r36': 1.0892, 'a36': 119.34, 'd36': 180.87,
    'r37': 1.0918, 'a37': 119.49, 'd37': 179.81}

Dimension = 9
Zero_Energy = -26399


def feature2atoms(f):
    dihe_angles = {
        "D1": f[0] / 2, "D2": f[1], "D3": f[2], "D4": f[3], "D5": f[4],
        "D6": f[5], "D7": f[6], "D8": f[7], "D9": f[8]
    }

    data = convert.generate_data(Data, **dihe_angles)
    pos = convert.generate_position(Structure, data)
    return Elements, pos


def atoms2feature(e, pos):
    template = {"elements": Elements, "structure": Structure, "data": Data}
    e, pos = convert.auto_refine(
        e, pos, template, radius_error=0.15, angle_error=20)
    data = convert.generate_variable(Structure, pos)
    args = (8, 9, 11, 13, 15, 17, 18, 21, 28)
    feature = [data["d%d" % i] for i in args]
    feature[0] = (feature[0] * 2) % 360

    return feature
